import React, { useState, useEffect } from 'react';
import { 
  Search, 
  Play, 
  Square, 
  Shield, 
  AlertTriangle, 
  CheckCircle,
  Clock,
  Target,
  Globe,
  Wifi,
  Server,
  Database,
  FileText,
  Download,
  Settings,
  RefreshCw,
  Eye,
  TrendingUp,
  Map,
  Plus
} from 'lucide-react';

// Types
interface ScanTarget {
  id: string;
  url: string;
  type: 'url' | 'ip' | 'range' | 'domain';
  status: 'pending' | 'scanning' | 'completed' | 'failed';
  progress: number;
  vulnerabilities: Vulnerability[];
  scanTime?: number;
  startedAt?: Date;
  completedAt?: Date;
}

interface Vulnerability {
  id: string;
  type: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  confidence: number;
  title: string;
  description: string;
  url: string;
  parameter?: string;
  evidence: string;
  solution: string;
  cwe: string;
  owasp: string;
  cvss: number;
}

interface ScanConfig {
  ports: string;
  scanType: 'quick' | 'comprehensive' | 'stealth';
  intensity: 'low' | 'medium' | 'high';
  enableVulnScan: boolean;
  enableSSLCheck: boolean;
  enableDirBrute: boolean;
  enableSubdomain: boolean;
  timeout: number;
  threads: number;
}

interface PortResult {
  port: number;
  protocol: 'tcp' | 'udp';
  state: 'open' | 'closed' | 'filtered';
  service: string;
  version?: string;
  product?: string;
}

const VulnerabilityScanner: React.FC = () => {
  const [isDarkMode] = useState(true);
  const [targets, setTargets] = useState<ScanTarget[]>([]);
  const [activeTargetId, setActiveTargetId] = useState<string | null>(null);
  const [scanConfig, setScanConfig] = useState<ScanConfig>({
    ports: '1-1000',
    scanType: 'comprehensive',
    intensity: 'medium',
    enableVulnScan: true,
    enableSSLCheck: true,
    enableDirBrute: true,
    enableSubdomain: false,
    timeout: 5000,
    threads: 10
  });
  const [newTarget, setNewTarget] = useState('');
  const [targetType, setTargetType] = useState<'url' | 'ip' | 'range' | 'domain'>('url');
  const [isScanning, setIsScanning] = useState(false);

  // Scan templates
  const scanTemplates = {
    quick: {
      name: 'Quick Scan',
      description: 'Fast scan of common ports and basic vulnerability checks',
      config: { ports: '1-1000', timeout: 3000, threads: 5, intensity: 'low' as const }
    },
    comprehensive: {
      name: 'Comprehensive Scan',
      description: 'Detailed scan with extensive vulnerability testing',
      config: { ports: '1-65535', timeout: 10000, threads: 15, intensity: 'high' as const }
    },
    stealth: {
      name: 'Stealth Scan',
      description: 'Slow, low-profile scan to avoid detection',
      config: { ports: '1-10000', timeout: 15000, threads: 3, intensity: 'low' as const }
    }
  };

  // Predefined vulnerability types
  const vulnerabilityTypes = [
    {
      type: 'SQL Injection',
      severity: 'critical' as const,
      description: 'SQL injection vulnerability detected',
      cwe: 'CWE-89',
      owasp: 'A03:2021',
      cvss: 9.8
    },
    {
      type: 'Cross-Site Scripting (XSS)',
      severity: 'high' as const,
      description: 'Cross-site scripting vulnerability found',
      cwe: 'CWE-79',
      owasp: 'A03:2021',
      cvss: 7.2
    },
    {
      type: 'Command Injection',
      severity: 'critical' as const,
      description: 'OS command injection vulnerability detected',
      cwe: 'CWE-78',
      owasp: 'A03:2021',
      cvss: 9.1
    },
    {
      type: 'Directory Traversal',
      severity: 'high' as const,
      description: 'Path traversal vulnerability allows file access',
      cwe: 'CWE-22',
      owasp: 'A01:2021',
      cvss: 8.1
    },
    {
      type: 'Weak SSL/TLS Configuration',
      severity: 'medium' as const,
      description: 'SSL/TLS configuration has security weaknesses',
      cwe: 'CWE-327',
      owasp: 'A02:2021',
      cvss: 5.9
    },
    {
      type: 'Missing Security Headers',
      severity: 'low' as const,
      description: 'Missing important security headers',
      cwe: 'CWE-16',
      owasp: 'A05:2021',
      cvss: 3.1
    },
    {
      type: 'Information Disclosure',
      severity: 'medium' as const,
      description: 'Sensitive information is exposed',
      cwe: 'CWE-200',
      owasp: 'A01:2021',
      cvss: 5.3
    },
    {
      type: 'Authentication Bypass',
      severity: 'critical' as const,
      description: 'Authentication mechanisms can be bypassed',
      cwe: 'CWE-287',
      owasp: 'A07:2021',
      cvss: 9.8
    }
  ];

  // Add new target
  const addTarget = () => {
    if (!newTarget.trim()) return;

    const target: ScanTarget = {
      id: Date.now().toString(),
      url: newTarget,
      type: targetType,
      status: 'pending',
      progress: 0,
      vulnerabilities: []
    };

    setTargets(prev => [...prev, target]);
    setActiveTargetId(target.id);
    setNewTarget('');
  };

  // Start scan
  const startScan = async (targetId: string) => {
    const target = targets.find(t => t.id === targetId);
    if (!target) return;

    setIsScanning(true);
    
    // Update target status
    setTargets(prev => prev.map(t => 
      t.id === targetId 
        ? { ...t, status: 'scanning', startedAt: new Date(), progress: 0 }
        : t
    ));

    const startTime = Date.now();
    const scanSteps = [
      { name: 'Host Discovery', weight: 10 },
      { name: 'Port Scanning', weight: 25 },
      { name: 'Service Detection', weight: 15 },
      { name: 'SSL/TLS Analysis', weight: 10 },
      { name: 'Directory Bruteforcing', weight: 15 },
      { name: 'Vulnerability Testing', weight: 20 },
      { name: 'Report Generation', weight: 5 }
    ];

    let currentProgress = 0;

    // Simulate scan progress
    for (const step of scanSteps) {
      for (let i = 0; i <= step.weight; i++) {
        await new Promise(resolve => setTimeout(resolve, scanConfig.timeout / step.weight));
        currentProgress += 1;
        
        setTargets(prev => prev.map(t => 
          t.id === targetId 
            ? { ...t, progress: Math.min(100, (currentProgress / 100) * 100) }
            : t
        ));
      }
    }

    // Generate mock vulnerabilities based on target
    const generatedVulns = generateVulnerabilities(target.url);
    
    const endTime = Date.now();
    
    // Update target as completed
    setTargets(prev => prev.map(t => 
      t.id === targetId 
        ? { 
            ...t, 
            status: 'completed', 
            progress: 100, 
            completedAt: new Date(),
            scanTime: endTime - startTime,
            vulnerabilities: generatedVulns
          }
        : t
    ));

    setIsScanning(false);
  };

  // Generate mock vulnerabilities
  const generateVulnerabilities = (targetUrl: string): Vulnerability[] => {
    const vulns: Vulnerability[] = [];
    const vulnCount = Math.floor(Math.random() * 5) + 1; // 1-5 vulnerabilities

    for (let i = 0; i < vulnCount; i++) {
      const vulnType = vulnerabilityTypes[Math.floor(Math.random() * vulnerabilityTypes.length)];
      
      vulns.push({
        id: `vuln_${Date.now()}_${i}`,
        type: vulnType.type,
        severity: vulnType.severity,
        confidence: Math.floor(Math.random() * 20) + 80, // 80-100%
        title: vulnType.type,
        description: vulnType.description,
        url: targetUrl,
        parameter: Math.random() > 0.7 ? `param${i}` : undefined,
        evidence: `Evidence found in response: ${vulnType.type} pattern detected`,
        solution: getSolutionGuidance(vulnType.type),
        cwe: vulnType.cwe,
        owasp: vulnType.owasp,
        cvss: vulnType.cvss
      });
    }

    return vulns;
  };

  // Get solution guidance
  const getSolutionGuidance = (vulnType: string): string => {
    const solutions = {
      'SQL Injection': 'Use parameterized queries, input validation, and least privilege database accounts.',
      'Cross-Site Scripting (XSS)': 'Implement Content Security Policy, sanitize user input, and encode output.',
      'Command Injection': 'Avoid executing system commands, use allowlists, and validate input strictly.',
      'Directory Traversal': 'Validate file paths, use allowlists, and avoid user input in file operations.',
      'Weak SSL/TLS Configuration': 'Use strong cipher suites, disable weak protocols, and implement proper certificate validation.',
      'Missing Security Headers': 'Implement security headers like CSP, HSTS, X-Frame-Options, and X-Content-Type-Options.',
      'Information Disclosure': 'Remove sensitive information from responses and implement proper access controls.',
      'Authentication Bypass': 'Strengthen authentication mechanisms and implement proper session management.'
    };
    return solutions[vulnType as keyof typeof solutions] || 'Implement appropriate security controls based on the vulnerability type.';
  };

  // Get vulnerability statistics
  const getVulnerabilityStats = (vulnerabilities: Vulnerability[]) => {
    return {
      critical: vulnerabilities.filter(v => v.severity === 'critical').length,
      high: vulnerabilities.filter(v => v.severity === 'high').length,
      medium: vulnerabilities.filter(v => v.severity === 'medium').length,
      low: vulnerabilities.filter(v => v.severity === 'low').length,
      total: vulnerabilities.length
    };
  };

  const activeTarget = targets.find(t => t.id === activeTargetId);

  return (
    <div className={`min-h-screen ${isDarkMode ? 'bg-gray-950' : 'bg-gray-50'}`}>
      <div className="p-6 space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className={`text-3xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-2`}>
              Vulnerability Scanner
            </h1>
            <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
              Automated security scanning with comprehensive vulnerability assessment
            </p>
          </div>
          <div className="flex items-center space-x-3">
            <button className={`px-4 py-2 rounded-lg border ${
              isDarkMode 
                ? 'border-gray-600 hover:bg-gray-800 text-gray-300' 
                : 'border-gray-300 hover:bg-gray-50 text-gray-700'
            } flex items-center space-x-2`}>
              <Settings className="w-4 h-4" />
              <span>Settings</span>
            </button>
            {activeTarget && activeTarget.status === 'scanning' && (
              <button
                onClick={() => {/* Stop scan logic */}}
                className="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center space-x-2"
              >
                <Square className="w-4 h-4" />
                <span>Stop Scan</span>
              </button>
            )}
          </div>
        </div>

        {/* Target Configuration */}
        <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border rounded-xl p-6`}>
          <h2 className={`text-xl font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-4`}>
            Scan Targets
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className={`block text-sm font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>
                Target URL/IP/Range
              </label>
              <div className="flex space-x-2">
                <select
                  value={targetType}
                  onChange={(e) => setTargetType(e.target.value as any)}
                  className={`px-3 py-2 rounded-lg border ${
                    isDarkMode
                      ? 'bg-gray-700 border-gray-600 text-white'
                      : 'bg-white border-gray-300 text-gray-900'
                  }`}
                >
                  <option value="url">URL</option>
                  <option value="ip">IP Address</option>
                  <option value="range">IP Range</option>
                  <option value="domain">Domain</option>
                </select>
                <input
                  type="text"
                  value={newTarget}
                  onChange={(e) => setNewTarget(e.target.value)}
                  placeholder="Enter target..."
                  className={`flex-1 px-4 py-2 rounded-lg border ${
                    isDarkMode
                      ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400'
                      : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500'
                  }`}
                />
                <button
                  onClick={addTarget}
                  disabled={!newTarget.trim()}
                  className="px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-500 text-white rounded-lg transition-colors"
                >
                  <Plus className="w-4 h-4" />
                </button>
              </div>
            </div>
            <div>
              <label className={`block text-sm font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>
                Scan Template
              </label>
              <select
                value={scanConfig.scanType}
                onChange={(e) => {
                  const template = scanTemplates[e.target.value as keyof typeof scanTemplates];
                  setScanConfig(prev => ({ ...prev, ...template.config, scanType: e.target.value as any }));
                }}
                className={`w-full px-4 py-2 rounded-lg border ${
                  isDarkMode
                    ? 'bg-gray-700 border-gray-600 text-white'
                    : 'bg-white border-gray-300 text-gray-900'
                }`}
              >
                {Object.entries(scanTemplates).map(([key, template]) => (
                  <option key={key} value={key}>{template.name}</option>
                ))}
              </select>
              <p className={`text-xs mt-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                {scanTemplates[scanConfig.scanType as keyof typeof scanTemplates]?.description}
              </p>
            </div>
          </div>
        </div>

        {/* Scan Configuration */}
        <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border rounded-xl p-6`}>
          <h2 className={`text-xl font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-4`}>
            Scan Configuration
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label className={`block text-sm font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>
                Port Range
              </label>
              <input
                type="text"
                value={scanConfig.ports}
                onChange={(e) => setScanConfig(prev => ({ ...prev, ports: e.target.value }))}
                className={`w-full px-4 py-2 rounded-lg border ${
                  isDarkMode
                    ? 'bg-gray-700 border-gray-600 text-white'
                    : 'bg-white border-gray-300 text-gray-900'
                }`}
              />
            </div>
            <div>
              <label className={`block text-sm font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>
                Timeout (ms)
              </label>
              <input
                type="number"
                value={scanConfig.timeout}
                onChange={(e) => setScanConfig(prev => ({ ...prev, timeout: parseInt(e.target.value) || 5000 }))}
                className={`w-full px-4 py-2 rounded-lg border ${
                  isDarkMode
                    ? 'bg-gray-700 border-gray-600 text-white'
                    : 'bg-white border-gray-300 text-gray-900'
                }`}
              />
            </div>
            <div>
              <label className={`block text-sm font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>
                Threads
              </label>
              <input
                type="number"
                value={scanConfig.threads}
                onChange={(e) => setScanConfig(prev => ({ ...prev, threads: parseInt(e.target.value) || 10 }))}
                className={`w-full px-4 py-2 rounded-lg border ${
                  isDarkMode
                    ? 'bg-gray-700 border-gray-600 text-white'
                    : 'bg-white border-gray-300 text-gray-900'
                }`}
              />
            </div>
          </div>
          
          <div className="mt-6">
            <h3 className={`text-lg font-medium ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-3`}>
              Scan Features
            </h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {[
                { key: 'enableVulnScan', label: 'Vulnerability Scan', icon: Shield },
                { key: 'enableSSLCheck', label: 'SSL/TLS Check', icon: Globe },
                { key: 'enableDirBrute', label: 'Directory Bruteforce', icon: Database },
                { key: 'enableSubdomain', label: 'Subdomain Discovery', icon: Wifi }
              ].map(({ key, label, icon: Icon }) => (
                <label key={key} className="flex items-center space-x-3 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={scanConfig[key as keyof ScanConfig] as boolean}
                    onChange={(e) => setScanConfig(prev => ({ ...prev, [key]: e.target.checked }))}
                    className="w-4 h-4"
                  />
                  <Icon className={`w-4 h-4 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`} />
                  <span className={`text-sm ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                    {label}
                  </span>
                </label>
              ))}
            </div>
          </div>
        </div>

        {/* Targets List */}
        {targets.length > 0 && (
          <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border rounded-xl overflow-hidden`}>
            <div className={`p-4 border-b ${isDarkMode ? 'border-gray-700' : 'border-gray-200'}`}>
              <h2 className={`text-xl font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                Scan Targets ({targets.length})
              </h2>
            </div>
            <div className="divide-y divide-gray-700">
              {targets.map((target) => {
                const stats = getVulnerabilityStats(target.vulnerabilities);
                return (
                  <div
                    key={target.id}
                    className={`p-4 hover:bg-opacity-50 transition-colors cursor-pointer ${
                      target.id === activeTargetId
                        ? isDarkMode ? 'bg-blue-500/10' : 'bg-blue-50'
                        : isDarkMode ? 'hover:bg-gray-750' : 'hover:bg-gray-50'
                    }`}
                    onClick={() => setActiveTargetId(target.id)}
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <div className="flex items-center space-x-2">
                          {target.status === 'completed' && <CheckCircle className="w-5 h-5 text-green-400" />}
                          {target.status === 'scanning' && <RefreshCw className="w-5 h-5 text-blue-400 animate-spin" />}
                          {target.status === 'failed' && <AlertTriangle className="w-5 h-5 text-red-400" />}
                          {target.status === 'pending' && <Clock className="w-5 h-5 text-gray-400" />}
                          <Target className="w-5 h-5 text-gray-400" />
                        </div>
                        <div>
                          <h3 className={`font-medium ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                            {target.url}
                          </h3>
                          <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                            {target.type} • {target.status}
                            {target.scanTime && ` • ${(target.scanTime / 1000).toFixed(1)}s`}
                          </p>
                        </div>
                      </div>
                      
                      <div className="flex items-center space-x-4">
                        {/* Vulnerability Summary */}
                        {target.vulnerabilities.length > 0 && (
                          <div className="flex items-center space-x-2">
                            {stats.critical > 0 && (
                              <span className="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs font-medium">
                                {stats.critical} Critical
                              </span>
                            )}
                            {stats.high > 0 && (
                              <span className="px-2 py-1 bg-orange-500/20 text-orange-400 rounded text-xs font-medium">
                                {stats.high} High
                              </span>
                            )}
                            {stats.medium > 0 && (
                              <span className="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs font-medium">
                                {stats.medium} Medium
                              </span>
                            )}
                            {stats.low > 0 && (
                              <span className="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs font-medium">
                                {stats.low} Low
                              </span>
                            )}
                          </div>
                        )}

                        {/* Progress Bar */}
                        {target.status === 'scanning' && (
                          <div className="w-32">
                            <div className={`w-full ${isDarkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full h-2`}>
                              <div
                                className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                style={{ width: `${target.progress}%` }}
                              />
                            </div>
                            <p className={`text-xs text-center mt-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                              {Math.round(target.progress)}%
                            </p>
                          </div>
                        )}

                        {/* Action Button */}
                        {target.status === 'pending' && (
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              startScan(target.id);
                            }}
                            disabled={isScanning}
                            className="px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-500 text-white rounded-lg flex items-center space-x-2"
                          >
                            <Play className="w-4 h-4" />
                            <span>Start</span>
                          </button>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* Active Target Details */}
        {activeTarget && (
          <div className={`${isDarkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'} border rounded-xl p-6`}>
            <div className="flex items-center justify-between mb-6">
              <h2 className={`text-xl font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                Scan Results: {activeTarget.url}
              </h2>
              <div className="flex items-center space-x-3">
                <button className={`px-4 py-2 rounded-lg border ${
                  isDarkMode 
                    ? 'border-gray-600 hover:bg-gray-700 text-gray-300' 
                    : 'border-gray-300 hover:bg-gray-50 text-gray-700'
                } flex items-center space-x-2`}>
                  <Download className="w-4 h-4" />
                  <span>Export Report</span>
                </button>
                <button className={`px-4 py-2 rounded-lg border ${
                  isDarkMode 
                    ? 'border-gray-600 hover:bg-gray-700 text-gray-300' 
                    : 'border-gray-300 hover:bg-gray-50 text-gray-700'
                } flex items-center space-x-2`}>
                  <Eye className="w-4 h-4" />
                  <span>View Details</span>
                </button>
              </div>
            </div>

            {/* Scan Statistics */}
            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
              <div className={`${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-50 border-gray-200'} border rounded-lg p-4`}>
                <div className="flex items-center justify-between">
                  <div>
                    <p className={`text-2xl font-bold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                      {activeTarget.vulnerabilities.length}
                    </p>
                    <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                      Total Findings
                    </p>
                  </div>
                  <AlertTriangle className="w-8 h-8 text-yellow-400" />
                </div>
              </div>
              <div className={`${isDarkMode ? 'bg-red-500/20 border-red-500/30' : 'bg-red-50 border-red-200'} border rounded-lg p-4`}>
                <div className="flex items-center justify-between">
                  <div>
                    <p className={`text-2xl font-bold text-red-400`}>
                      {activeTarget.vulnerabilities.filter(v => v.severity === 'critical').length}
                    </p>
                    <p className={`text-sm text-red-400`}>
                      Critical
                    </p>
                  </div>
                  <AlertTriangle className="w-8 h-8 text-red-400" />
                </div>
              </div>
              <div className={`${isDarkMode ? 'bg-orange-500/20 border-orange-500/30' : 'bg-orange-50 border-orange-200'} border rounded-lg p-4`}>
                <div className="flex items-center justify-between">
                  <div>
                    <p className={`text-2xl font-bold text-orange-400`}>
                      {activeTarget.vulnerabilities.filter(v => v.severity === 'high').length}
                    </p>
                    <p className={`text-sm text-orange-400`}>
                      High
                    </p>
                  </div>
                  <AlertTriangle className="w-8 h-8 text-orange-400" />
                </div>
              </div>
              <div className={`${isDarkMode ? 'bg-yellow-500/20 border-yellow-500/30' : 'bg-yellow-50 border-yellow-200'} border rounded-lg p-4`}>
                <div className="flex items-center justify-between">
                  <div>
                    <p className={`text-2xl font-bold text-yellow-400`}>
                      {activeTarget.vulnerabilities.filter(v => v.severity === 'medium').length}
                    </p>
                    <p className={`text-sm text-yellow-400`}>
                      Medium
                    </p>
                  </div>
                  <Shield className="w-8 h-8 text-yellow-400" />
                </div>
              </div>
              <div className={`${isDarkMode ? 'bg-blue-500/20 border-blue-500/30' : 'bg-blue-50 border-blue-200'} border rounded-lg p-4`}>
                <div className="flex items-center justify-between">
                  <div>
                    <p className={`text-2xl font-bold text-blue-400`}>
                      {activeTarget.vulnerabilities.filter(v => v.severity === 'low').length}
                    </p>
                    <p className={`text-sm text-blue-400`}>
                      Low
                    </p>
                  </div>
                  <Eye className="w-8 h-8 text-blue-400" />
                </div>
              </div>
            </div>

            {/* Vulnerabilities List */}
            {activeTarget.vulnerabilities.length > 0 && (
              <div className="space-y-4">
                {activeTarget.vulnerabilities.map((vulnerability) => (
                  <div key={vulnerability.id} className={`p-4 rounded-lg border ${
                    isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-50 border-gray-200'
                  }`}>
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <h3 className={`font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>
                          {vulnerability.title}
                        </h3>
                        <p className={`text-sm ${isDarkMode ? 'text-gray-400' : 'text-gray-600'} mb-2`}>
                          {vulnerability.description}
                        </p>
                        <div className="flex items-center space-x-4">
                          <span className={`px-2 py-1 rounded text-xs font-medium ${
                            vulnerability.severity === 'critical' ? 'bg-red-500/20 text-red-400' :
                            vulnerability.severity === 'high' ? 'bg-orange-500/20 text-orange-400' :
                            vulnerability.severity === 'medium' ? 'bg-yellow-500/20 text-yellow-400' :
                            'bg-blue-500/20 text-blue-400'
                          }`}>
                            {vulnerability.severity.toUpperCase()}
                          </span>
                          <span className={`text-xs ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                            CVSS: {vulnerability.cvss.toFixed(1)}
                          </span>
                          <span className={`text-xs ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                            Confidence: {vulnerability.confidence}%
                          </span>
                        </div>
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                      <div>
                        <h4 className={`font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-1`}>
                          Evidence:
                        </h4>
                        <p className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                          {vulnerability.evidence}
                        </p>
                      </div>
                      <div>
                        <h4 className={`font-medium ${isDarkMode ? 'text-gray-300' : 'text-gray-700'} mb-1`}>
                          Solution:
                        </h4>
                        <p className={`${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                          {vulnerability.solution}
                        </p>
                      </div>
                    </div>
                    
                    <div className="flex items-center justify-between mt-4">
                      <div className="flex items-center space-x-4">
                        <span className={`text-xs px-2 py-1 rounded ${
                          isDarkMode ? 'bg-blue-500/20 text-blue-400' : 'bg-blue-100 text-blue-600'
                        }`}>
                          {vulnerability.cwe}
                        </span>
                        <span className={`text-xs px-2 py-1 rounded ${
                          isDarkMode ? 'bg-purple-500/20 text-purple-400' : 'bg-purple-100 text-purple-600'
                        }`}>
                          {vulnerability.owasp}
                        </span>
                        <span className={`text-xs ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                          {vulnerability.url}
                        </span>
                      </div>
                      <button className={`px-3 py-1 rounded text-sm ${
                        isDarkMode 
                          ? 'bg-blue-600 hover:bg-blue-500 text-white' 
                          : 'bg-blue-500 hover:bg-blue-600 text-white'
                      } transition-colors`}>
                        View Details
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {activeTarget.status === 'completed' && activeTarget.vulnerabilities.length === 0 && (
              <div className="text-center py-12">
                <div className="w-16 h-16 mx-auto mb-4 p-4 bg-green-500/20 rounded-full">
                  <CheckCircle className="w-8 h-8 text-green-400 mx-auto" />
                </div>
                <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-2`}>
                  No Vulnerabilities Found
                </h3>
                <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                  The target appears to be secure against the tested vulnerability types.
                </p>
              </div>
            )}

            {activeTarget.status === 'scanning' && (
              <div className="text-center py-12">
                <div className="w-16 h-16 mx-auto mb-4 p-4 bg-blue-500/20 rounded-full animate-pulse">
                  <RefreshCw className="w-8 h-8 text-blue-400 mx-auto animate-spin" />
                </div>
                <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-2`}>
                  Scanning in Progress...
                </h3>
                <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                  Please wait while the vulnerability scan completes.
                </p>
                <div className="mt-4">
                  <div className={`w-full max-w-md mx-auto ${isDarkMode ? 'bg-gray-700' : 'bg-gray-200'} rounded-full h-2`}>
                    <div
                      className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                      style={{ width: `${activeTarget.progress}%` }}
                    />
                  </div>
                  <p className={`text-sm mt-2 ${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                    {Math.round(activeTarget.progress)}% Complete
                  </p>
                </div>
              </div>
            )}
          </div>
        )}

        {/* No targets state */}
        {targets.length === 0 && (
          <div className="text-center py-12">
            <div className="w-16 h-16 mx-auto mb-4 p-4 bg-gray-500/20 rounded-full">
              <Search className="w-8 h-8 text-gray-400 mx-auto" />
            </div>
            <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'} mb-2`}>
              No Scan Targets
            </h3>
            <p className={`${isDarkMode ? 'text-gray-400' : 'text-gray-600'}`}>
              Add a target URL, IP address, or domain to start vulnerability scanning.
            </p>
          </div>
        )}
      </div>
    </div>
  );
};

export default VulnerabilityScanner;